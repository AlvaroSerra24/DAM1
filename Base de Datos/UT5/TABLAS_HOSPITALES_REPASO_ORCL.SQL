------------------------------------------------------------
-- ORACLE
-- CREACIÓN HOSPITALES-SALAS-PLANTILLA-DOCTORES-ENFERMO
DROP TABLE HOSPITAL Cascade constraints; 

CREATE TABLE HOSPITAL (
 HOSPITAL_COD    NUMBER(2) NOT NULL primary key,
 NOMBRE          VARCHAR2(12) ,
 DIRECCION       VARCHAR2(20) ,
 TELEFONO        VARCHAR2(8) ,
 NUM_CAMAS        NUMBER(4)
   );

INSERT INTO HOSPITAL VALUES (13,'Provincial', 'O Donell 50', '964-4264',502);
INSERT INTO HOSPITAL VALUES (18,'General', 'Atocha s/n', '595-3111',987);
INSERT INTO HOSPITAL VALUES (22,'La Paz', 'Castellana 1000', '923-5411',412);
INSERT INTO HOSPITAL VALUES (45,'San Carlos', 'Ciudad Universitaria', '597-1500',845);


DROP TABLE SALA Cascade constraints; 

CREATE TABLE SALA (
 HOSPITAL_COD    NUMBER(2) NOT NULL,
 SALA_COD        NUMBER(2) NOT NULL,
 NOMBRE          VARCHAR2(20) ,
 NUM_CAMA        NUMBER(4),
 constraint pk_sal_hosp primary key(HOSPITAL_COD,SALA_COD),
 constraint fk_sal_hosp foreign key(HOSPITAL_COD) references hospital
   );


INSERT INTO SALA VALUES (13,3, 'Cuidados intensivos',21);
INSERT INTO SALA VALUES (13,6, 'Psiquiátrico', 67);
INSERT INTO SALA VALUES (18,3, 'Cuidados intensivos',10);
INSERT INTO SALA VALUES (18,4, 'Cardiología', 53);
INSERT INTO SALA VALUES (22,1, 'Recuperación', 10);
INSERT INTO SALA VALUES (22,6, 'Psiquiátrico', 118);
INSERT INTO SALA VALUES (22,2, 'Maternidad', 34);
INSERT INTO SALA VALUES (45,4, 'Cardiología', 55);
INSERT INTO SALA VALUES (45,1, 'Recuperación', 13);
INSERT INTO SALA VALUES (45,2, 'Maternidad',24);

DROP TABLE PLANTILLA cascade constraints; 

CREATE TABLE PLANTILLA (
 HOSPITAL_COD  NUMBER(2) NOT NULL,
 SALA_COD  NUMBER(2),
 EMPLEADO_NO  NUMBER(4) primary key,
 APELLIDO CHAR(16),
 FUNCION CHAR(10),
 TURNO CHAR(1),
 SALARIO NUMBER (10),
  constraint fk_plan_hosp foreign key(HOSPITAL_COD,SALA_COD) references SALA
  );

INSERT INTO PLANTILLA VALUES (13,6,3754,'Diaz B.','Enfermera','T',2262);
INSERT INTO PLANTILLA VALUES (13,6,3106,'Hernández J.','Enfermero','T',2750);
INSERT INTO PLANTILLA VALUES (18,4,6357,'Karplus W.','Interno','T',3379);
INSERT INTO PLANTILLA VALUES (22,6,1009,'Higueras D.','Enfermera','T',2005);
INSERT INTO PLANTILLA VALUES (22,6,8422,'Bocina G.','Enfermero','M',1838);
INSERT INTO PLANTILLA VALUES (22,2,9901,'Nuñez C.','Interno','M',2210);
INSERT INTO PLANTILLA VALUES (22,1,6065,'Rivera G.','Enfermera','N',1626);
INSERT INTO PLANTILLA VALUES (22,1,7379,'Carlos R.','Enfermera','T',2119);
INSERT INTO PLANTILLA VALUES (45,4,1280,'Amigo R.','Interno','N',2210);
INSERT INTO PLANTILLA VALUES (45,1,8526,'Frank H.','Enfermero','T',2522);
INSERT INTO PLANTILLA VALUES (45,2,2526,'Petra H.','Enfermera','T',2522);
INSERT INTO PLANTILLA VALUES (45,2,3406,'Juana Mar.','Enfermera','T',2522);

-- ********* TABLAS ENFERMO Y DOCTOR

DROP TABLE DOCTOR cascade constraints; 

CREATE TABLE DOCTOR (
 HOSPITAL_COD  NUMBER(2) NOT NULL,
 DOCTOR_NO  NUMBER(3) NOT NULL primary key,
 APELLIDO CHAR(16),
 ESPECIALIDAD CHAR(16),
constraint fk_doct_hosp foreign key(HOSPITAL_COD) references hospital ) ;

INSERT INTO DOCTOR VALUES (13,435,'Lopez A.','Cardiología');
INSERT INTO DOCTOR VALUES (18,585,'Miller G.','Ginecología');
INSERT INTO DOCTOR VALUES (18,982,'Cajal R.','Cardiología');
INSERT INTO DOCTOR VALUES (22,453,'Galo D.','Pediatría');
INSERT INTO DOCTOR VALUES (22,398,'Best D.','Urología');
INSERT INTO DOCTOR VALUES (22,386,'Cabeza D.','Psiquiatría');
INSERT INTO DOCTOR VALUES (45,607,'Nino P.','Pediatría');
INSERT INTO DOCTOR VALUES (45,522,'Adams C.','Neurología');


DROP TABLE ENFERMO cascade constraints; 

CREATE TABLE ENFERMO (
 INSCRIPCION  NUMBER(5) NOT NULL primary key,
 APELLIDO  VARCHAR2(14), 
 DIRECCION  VARCHAR(20), 
 FECHA_NAC  DATE,
 S CHAR (1),
 NSS      NUMBER(9),
 HOSPITAL_COD    NUMBER(2),
 constraint fk_enf_hosp foreign key(HOSPITAL_COD) references hospital 
 );

ALTER SESSION SET NLS_DATE_FORMAT='DD/MM/YYYY';

INSERT INTO ENFERMO VALUES (10995,'Laguía M.','Goya, 20','16/05/1956','M',280862482,13);
INSERT INTO ENFERMO VALUES (18004,'Serrano V.','Alcala 12','21/05/1960','F',284991452,18);
INSERT INTO ENFERMO VALUES (14024,'Fernández M.','Recoletos 50','23/06/1967','F',321790059,13);
INSERT INTO ENFERMO VALUES (36658,'Domin S.','Mayor 71','01/01/1942','M',160654471,22);
INSERT INTO ENFERMO VALUES (38702,'Neal R.','Orense 11','18/06/1940','F',380010217,22);
INSERT INTO ENFERMO VALUES (39217,'Cervantes M.','Perón 38','29/02/1952','M',440294390,13);
INSERT INTO ENFERMO VALUES (59076,'Miller B.','Lopez de Hoyos 2','16/09/1945','F',311969044,22);
INSERT INTO ENFERMO VALUES (63827,'Ruiz P.','Esquerdo 103','26/12/1980','M',100973253,18);
INSERT INTO ENFERMO VALUES (64823,'Fraser A.','Soto 3','10/07/1980','F',285201776,18);
INSERT INTO ENFERMO VALUES (74835,'Benitez E.','Argentina 5','05/10/1957','M',154811767,18);
COMMIT;
ALTER SESSION SET NLS_DATE_FORMAT='DD/MM/YY';

/*EJERCICIO 1*/
SELECT APELLIDO, FUNCION, TURNO
FROM PLANTILLA
WHERE FUNCION IN('Enfermero','Enfermera') AND TURNO IN('T','M');

/*EJERCICIO 2*/
SELECT APELLIDO, FUNCION, SALARIO
FROM PLANTILLA
WHERE FUNCION = 'Enfermera'
AND SALARIO BETWEEN 2000 AND 2500;

/*EJERCICIO 3*/
SELECT APELLIDO, TO_CHAR(SALARIO*12, '999g999D99') "Salario anual" 
FROM PLANTILLA
WHERE FUNCION IN('Enfermero', 'Enfermera');

/*EJERCICIO 4*/
SELECT SUBSTR(NOMBRE,1,3)"ABR", HOSPITAL_COD,NOMBRE
FROM HOSPITAL
ORDER BY SUBSTR(NOMBRE,1,3);

/*EJERCICIO 5*/
SELECT APELLIDO, ESPECIALIDAD, 
    DECODE(RTRIM(ESPECIALIDAD), 'Cardiología',1,'Psiquiatría',2,'Pediatría',3,4) CODIGO
FROM DOCTOR ;

/*EJERCICIO 6*/
SELECT TO_CHAR(AVG(SALARIO),'999G999G999D99') "Salario Medio"
FROM PLANTILLA
WHERE FUNCION='Interno';

/*EJERCICIO 7*/
SELECT TO_CHAR(MAX(SALARIO),'999G999D99')"MAXIMO"
,TO_CHAR(MIN(SALARIO),'999G999D99')"MINIMO",
TO_CHAR(MAX(SALARIO)-MIN(SALARIO),'999G999D99')"DIFERENCIA"
FROM PLANTILLA;

/*EJERCICIO 8*/
SELECT COUNT (DISTINCT FUNCION) TAREAS
FROM PLANTILLA
WHERE HOSPITAL_COD=22
AND SALA_COD IN(1,2);

/*EJERCICIO 9*/
SELECT TURNO, COUNT(*) PERSONAS
FROM PLANTILLA
GROUP BY TURNO, FUNCION
HAVING COUNT(*)>2;

/*EJERCICIO 10*/
SELECT TURNO, COUNT(*) PERSONAS
FROM PLANTILLA
GROUP BY TURNO
HAVING COUNT(*)>2;

/*EJERCICIO 11*/
SELECT APELLIDO, FUNCION, NOMBRE, SALA_COD
FROM PLANTILLA P JOIN HOSPITAL H ON(P.HOSPITAL_COD=H.HOSPITAL_COD);

/*EJERCICIO 12*/
SELECT P.APELLIDO, P.FUNCION, S.NOMBRE, P.SALA_COD
FROM PLANTILLA P JOIN SALA S ON(S.SALA_COD=P.SALA_COD) 
AND(P.HOSPITAL_COD=S.HOSPITAL_COD);

/*EJERCICIO 13*/
SELECT APELLIDO, FUNCION, TURNO, SALARIO
FROM PLANTILLA
WHERE SALARIO > (SELECT MIN(SALARIO)
FROM PLANTILLA
WHERE UPPER(TURNO)='N')
ORDER BY SALARIO DESC;

/*EJERCICIO 14*/
SELECT HOSPITAL_COD, SALA_COD, NOMBRE, COUNT(EMPLEADO_NO)
FROM SALA LEFT JOIN PLANTILLA USING(HOSPITAL_COD, SALA_COD)
GROUP BY HOSPITAL_COD, SALA_COD, NOMBRE
ORDER BY SALA_COD;

/*EJERCICIO 15*/
SELECT HOSPITAL_COD, NOMBRE, COUNT(INSCRIPCION) NUME
FROM HOSPITAL LEFT JOIN ENFERMO USING (HOSPITAL_COD)
GROUP BY HOSPITAL_COD, NOMBRE
ORDER BY HOSPITAL_COD;

/*EJERCICIO 16*/
SELECT SALA_COD, NOMBRE, NVL (APELLIDO, 0) APELLIDO
FROM SALA LEFT JOIN PLANTILLA USING (HOSPITAL_COD, SALA_COD)
ORDER BY SALA_COD;

/*EJERCICIO 17*/
SELECT P.HOSPITAL_COD, H.NOMBRE, S.SALA_COD, S.NOMBRE,
EMPLEADO_NO, APELLIDO, SALARIO
FROM PLANTILLA P JOIN SALA S ON (P.HOSPITAL_COD=S.HOSPITAL_COD
AND P.SALA_COD=S.SALA_COD)
JOIN HOSPITAL H ON (H.HOSPITAL_COD=S.HOSPITAL_COD)
WHERE (P.HOSPITAL_COD,P.SALA_COD, SALARIO)IN(SELECT HOSPITAL_COD, SALA_COD, MAX(SALARIO)
FROM PLANTILLA GROUP BY HOSPITAL_COD, SALA_COD)
ORDER BY HOSPITAL_COD;

/*EJERCICIO 18*/